<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LIFF → Googleフォーム 連携</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; padding: 20px; }
    .card { max-width: 720px; margin: 0 auto; padding: 16px; border: 1px solid #ddd; border-radius: 8px; }
    .ok { color: #0a7; }
    .ng { color: #d33; }
    button { padding: 10px 16px; font-size: 16px; }
    .hint { color:#666; font-size: 13px; }
  </style>
</head>
<body>
  <div class="card">
    <h2>LINE ログイン → Googleフォーム送信</h2>

    <p id="status" class="hint">LIFF 初期化中…</p>

    <!-- ★★★ ここが重要：formResponse に POST ★★★ -->
    <form
      id="gform"
      action="https://docs.google.com/forms/d/e/1FAIpQLSfSN0Zb6NY7edTlWuZoxRtgV61U5PiNk-oXtmE9XUsYtNLenw/formResponse"
      method="POST"
      target="_self"
      enctype="application/x-www-form-urlencoded">

      <!-- ここはあなたのフォームの “userId” 用の entry 番号に合わせる -->
      <input type="hidden" name="entry.2061017733" id="entry_userid" />

      <!-- 表示名など（任意） -->
      <input type="hidden" name="entry.1119093151" id="entry_displayName" />

      <!-- 必要なら他の項目も hidden で埋める（任意）
      <input type="hidden" name="entry.1947235779" id="entry_other1" />
      <input type="hidden" name="entry.1748558192" id="entry_other2" />
      -->

      <button id="submitBtn" type="submit" disabled>送信（userId 取得後に有効化）</button>
    </form>

    <p class="hint">
      ※ LINEアプリ内でページを開くと自動的に userId を取得してフォームに送信できます。<br>
      ※ PCブラウザでテストする場合は LIFF ログインが動かないので、仮値を手動セットしてください（デバッグ時）。
    </p>

    <pre id="debug" class="hint"></pre>
  </div>

<script>
  const LIFF_ID = "【あなたの LIFF ID】";  // 例: 2007882844-1lMbv7NY

  async function main() {
    try {
      document.getElementById('status').textContent = 'LIFF 初期化中…';
      await liff.init({ liffId: LIFF_ID });

      if (!liff.isLoggedIn()) {
        document.getElementById('status').textContent = 'ログインへ遷移します…';
        liff.login();
        return;
      }

      const profile = await liff.getProfile();
      // ▼ ここで hidden に値を設定（entry 番号はあなたのフォームに合わせている）
      document.getElementById('entry_userid').value      = profile.userId;
      document.getElementById('entry_displayName').value = profile.displayName;

      // デバッグ表示（確認用）
      const dbg = [
        'userId: ' + profile.userId,
        'displayName: ' + profile.displayName
      ].join('\n');
      document.getElementById('debug').textContent = dbg;

      // 送信ボタンを有効化
      document.getElementById('submitBtn').disabled = false;
      document.getElementById('status').innerHTML =
        '<span class="ok">userId の取得に成功。送信できます。</span>';

    } catch (e) {
      document.getElementById('status').innerHTML =
        '<span class="ng">LIFF 初期化またはプロフィール取得に失敗：' + e.message + '</span>';
      console.error(e);
      // PCデバッグ時は仮値を入れると送信検証が可能（開発時のみ）
      // document.getElementById('entry_userid').value = 'Uxxxxxxxxxxxxxxxx';
      // document.getElementById('submitBtn').disabled = false;
    }
  }
  main();
</script>
</body>
</html>